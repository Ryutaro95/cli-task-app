# 要件定義書 - ゴミ箱機能の実装

## 問題の概要
現在のタスク削除機能では、削除したタスクを元に戻すことができず、誤削除時の復旧手段がない。ユーザーが安心してタスク削除操作を行えるよう、削除したタスクを一時的に保持し復元可能なゴミ箱機能が必要である。

## 機能要件

### FR-1: ゴミ箱への移動
- タスク削除時、完全削除ではなくゴミ箱状態に移動
- ゴミ箱内のタスクは通常のタスクリストに表示されない
- 削除日時を記録し、自動削除のタイマーを開始

### FR-2: ゴミ箱画面
- 専用のゴミ箱画面を提供
- ゴミ箱内のタスク一覧表示
- 各タスクの削除日時表示
- 自動削除までの残り日数表示

### FR-3: タスク復元機能
- ゴミ箱からタスクを選択して復元
- 復元時は元の状態（完了/未完了）を維持
- 復元後は通常のタスクリストに表示

### FR-4: 完全削除機能
- ゴミ箱内のタスクを完全削除
- 手動での完全削除機能
- 自動削除（30日後）
- 一括削除機能（ゴミ箱を空にする）

### FR-5: ナビゲーション
- メインメニューからゴミ箱画面へアクセス
- ゴミ箱画面からメイン画面へ戻る
- 画面切り替えのキーバインド

## 非機能要件

### NFR-1: データ永続化
- ゴミ箱の状態をファイルに保存
- アプリケーション再起動後も状態維持
- データベース設計の拡張

### NFR-2: パフォーマンス
- ゴミ箱表示速度: < 200ms
- 復元処理速度: < 100ms
- 大量データ（1000件+）での動作保証

### NFR-3: ストレージ効率
- 自動削除による容量管理
- インデックス設計の最適化
- メモリ使用量の制御

## データ設計

### タスクステータス拡張
```go
type TaskStatus int

const (
    StatusActive TaskStatus = iota    // 通常のタスク
    StatusCompleted                   // 完了済みタスク
    StatusInTrash                     // ゴミ箱内タスク
)
```

### ゴミ箱メタデータ
```go
type TrashMetadata struct {
    DeletedAt     time.Time  // 削除日時
    AutoDeleteAt  time.Time  // 自動削除予定日時
    OriginalStatus TaskStatus // 元のステータス
}
```

## UI/UX設計

### メイン画面の拡張
- ゴミ箱へのショートカット表示
- ゴミ箱内アイテム数の表示

### ゴミ箱画面レイアウト
```
┌─────────────────────────────────────────┐
│              ゴミ箱                     │
├─────────────────────────────────────────┤
│ [R]復元  [D]完全削除  [C]一括削除       │
├─────────────────────────────────────────┤
│ ○ 買い物リスト作成                      │
│   削除日: 2024-01-15  残り: 25日        │
│                                         │
│ ○ プロジェクト企画書                    │
│   削除日: 2024-01-10  残り: 20日        │
│                                         │
│ (空のゴミ箱)                            │
└─────────────────────────────────────────┘
```

### キーバインド設計
- `g` + `t`: ゴミ箱画面へ移動
- `r`: 選択タスクを復元
- `D`: 選択タスクを完全削除（確認付き）
- `C`: 全タスクを完全削除（確認付き）
- `q` / `Escape`: メイン画面に戻る

## 自動削除ポリシー

### デフォルト設定
- 自動削除期間: 30日
- チェック間隔: アプリ起動時
- 設定可能項目: 自動削除期間（7日〜90日）

### 削除前通知（将来拡張）
- 自動削除3日前に通知
- 一括通知機能

## セキュリティ考慮事項

### データ保護
- 完全削除時の安全な消去
- 機密タスクの取り扱い

### 復元制限
- 復元権限の管理（将来拡張）
- 監査ログの記録（将来拡張）

## 受け入れ基準
- [ ] タスク削除時にゴミ箱へ移動される
- [ ] ゴミ箱画面で削除済みタスク一覧が表示される
- [ ] 削除日時と自動削除までの残り日数が表示される
- [ ] ゴミ箱からタスクを復元できる
- [ ] 復元したタスクが元の状態で通常リストに表示される
- [ ] ゴミ箱内のタスクを完全削除できる
- [ ] 30日経過したタスクが自動削除される
- [ ] ゴミ箱を一括で空にできる
- [ ] アプリ再起動後もゴミ箱の状態が保持される
- [ ] メイン画面とゴミ箱画面間の切り替えができる