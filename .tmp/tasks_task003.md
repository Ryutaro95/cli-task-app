# タスクリスト - ゴミ箱機能の実装

## 実装タスク

### Phase 1: データモデル・永続化層の拡張
- [ ] **Task 1.1**: 既存コードベース調査
  - 現在のTask構造体の確認
  - データベース/ストレージ層の理解
  - 既存の削除処理の分析

- [ ] **Task 1.2**: データモデル拡張（TDD）
  - TaskStatus列挙型の定義とテスト
  - TrashMetadata構造体の定義とテスト
  - Task構造体へのTrashData フィールド追加

- [ ] **Task 1.3**: データベース/ストレージ層拡張
  - スキーマ変更（status, deleted_at, auto_delete_at列追加）
  - インデックス追加（status, auto_delete_at）
  - マイグレーション処理の実装

- [ ] **Task 1.4**: Repository層の拡張
  - GetTrashTasks() メソッド実装
  - GetExpiredTrashTasks() メソッド実装
  - 既存クエリのstatus条件追加

### Phase 2: TrashService実装
- [ ] **Task 2.1**: TrashService インターフェース定義（TDD）
  - サービスインターフェースの定義
  - エラー型の定義
  - テストケース作成

- [ ] **Task 2.2**: 基本的なTrash操作実装
  - MoveToTrash() メソッド実装
  - RestoreFromTrash() メソッド実装
  - PermanentDelete() メソッド実装

- [ ] **Task 2.3**: 一括操作実装
  - EmptyTrash() メソッド実装
  - ListTrashTasks() メソッド実装
  - エラーハンドリングの強化

- [ ] **Task 2.4**: 自動削除機能実装
  - AutoCleanup() メソッド実装
  - 期限切れタスクの検出ロジック
  - バックグラウンド処理の設計

### Phase 3: UI層の拡張
- [ ] **Task 3.1**: TrashViewコンポーネント実装（TDD）
  - 基本的なTrashView構造体定義
  - Update() メソッドのキーハンドリング
  - View() メソッドでの表示ロジック

- [ ] **Task 3.2**: 画面遷移の実装
  - Main View からTrash Viewへの遷移
  - Trash ViewからMain Viewへの復帰
  - キーバインドの統合（gt, q, esc）

- [ ] **Task 3.3**: 確認ダイアログの共通化
  - ConfirmDialog コンポーネント実装
  - 復元確認ダイアログ
  - 完全削除確認ダイアログ
  - 一括削除確認ダイアログ

- [ ] **Task 3.4**: ゴミ箱表示機能
  - 削除済みタスク一覧表示
  - 削除日時と残り日数の表示
  - 選択とハイライト機能

### Phase 4: 既存機能との統合
- [ ] **Task 4.1**: 削除処理の変更
  - 既存の削除処理をMoveToTrashに変更
  - 削除キーのハンドリング更新
  - 完全削除への経路確保

- [ ] **Task 4.2**: メイン画面の拡張
  - ゴミ箱へのナビゲーション表示
  - ゴミ箱内アイテム数表示
  - ステータス表示の更新

- [ ] **Task 4.3**: アプリ起動処理の拡張
  - アプリ起動時の自動クリーンアップ
  - データ整合性チェック
  - 設定読み込みの統合

### Phase 5: 設定・自動化機能
- [ ] **Task 5.1**: 設定システムの拡張
  - TrashConfig 構造体実装
  - 設定ファイルでの自動削除期間設定
  - デフォルト値の適用

- [ ] **Task 5.2**: 自動削除ワーカー実装
  - AutoCleanupWorker 構造体実装
  - 定期実行スケジューラ
  - ログ出力の統合

- [ ] **Task 5.3**: 設定UI（将来拡張準備）
  - 設定画面の基本構造準備
  - 自動削除期間の動的変更準備

### Phase 6: テスト・品質保証
- [ ] **Task 6.1**: 包括的テストスイート
  - TrashService の全メソッドテスト
  - UI コンポーネントのテスト
  - データベース操作のテスト

- [ ] **Task 6.2**: 統合テストシナリオ
  - 削除→復元ワークフローテスト
  - 自動削除機能テスト
  - 大量データでのパフォーマンステスト

- [ ] **Task 6.3**: エラーケーステスト
  - データ不整合時の挙動
  - ディスク容量不足時の挙動
  - 並行アクセス時の挙動

### Phase 7: 仕上げ・ドキュメント化
- [ ] **Task 7.1**: パフォーマンス最適化
  - データベースクエリの最適化
  - メモリ使用量の最適化
  - UI のレスポンス改善

- [ ] **Task 7.2**: ユーザビリティ向上
  - キーバインドヘルプの更新
  - エラーメッセージの改善
  - 視覚的フィードバックの強化

- [ ] **Task 7.3**: コード品質向上
  - リント・型チェック実行
  - コードレビュー実施
  - リファクタリング（必要に応じて）

## 実装優先度

### 高優先度（MVP）
1. データモデル拡張（Phase 1）
2. 基本的なTrash操作（Phase 2.1-2.2）
3. 基本的なUI（Phase 3.1-3.2）
4. 既存機能との統合（Phase 4.1）

### 中優先度
1. 自動削除機能（Phase 2.4, 5.2）
2. 確認ダイアログ（Phase 3.3）
3. 包括的テスト（Phase 6.1-6.2）

### 低優先度（将来拡張）
1. 設定UI（Phase 5.3）
2. 高度な最適化（Phase 7.1）

## リスク・注意事項
- **データマイグレーション**: 既存データの安全な移行
- **パフォーマンス**: 大量のゴミ箱データでの動作
- **ストレージ容量**: 自動削除によるディスク使用量管理
- **同期処理**: 削除・復元操作の原子性保証

## 成功指標
- [ ] 誤削除からの復元率: 100%
- [ ] ゴミ箱操作のレスポンス時間: < 200ms
- [ ] 自動削除による容量管理: 設定期間での確実な削除
- [ ] 既存機能への影響: ゼロ（非破壊的変更）