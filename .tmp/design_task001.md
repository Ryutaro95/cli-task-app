# 設計書 - タスク新規作成・編集画面のキーバインド改善

## システム設計概要
TUIアプリケーションのInputFormWidget内でのナビゲーションキーバインドを拡張し、ctrl+j/ctrl+kによるフィールド間移動を実装する。

## アーキテクチャ設計

### 対象コンポーネント
- `InputFormWidget`: タスク作成・編集フォームのメインコンポーネント
- キーハンドラ: キーイベントの処理ロジック

### 既存システムの分析
現在のシステムは以下の構造と推測：
- Bubbletea/Lipgloss ベースのTUIアプリケーション
- InputFormWidget でフォームフィールド管理
- tab/shift+tab での基本ナビゲーション実装済み

## 詳細設計

### 1. キーバインド処理の拡張

#### 対象ファイル
- `internal/ui/widgets/input_form.go` (推測)
- または関連するフォーム処理ファイル

#### 実装方針
```go
// 既存のキーハンドラを拡張
func (w *InputFormWidget) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
    switch msg := msg.(type) {
    case tea.KeyMsg:
        switch msg.String() {
        case "tab", "ctrl+j":
            return w.nextField()
        case "shift+tab", "ctrl+k":
            return w.prevField()
        // 既存の他のキー処理...
        }
    }
    return w, nil
}
```

### 2. フィールドナビゲーションロジック

#### 現在の実装状況調査が必要
- フィールドリストの管理方法
- 現在のアクティブフィールドの追跡方法
- 循環ナビゲーションの実装状況

#### 拡張ポイント
- キーマッピングテーブルの追加
- 統一されたナビゲーション関数の活用

### 3. 設定可能性（将来拡張）
- キーバインドの設定ファイル化
- ユーザーカスタマイズ対応

## データフロー設計

```
キー入力 -> KeyMsg -> InputFormWidget.Update() ->
フィールド切り替え処理 -> UIの再描画
```

## エラーハンドリング設計

### エラーケース
- 無効なフィールドインデックス
- 初期化されていないフィールドリスト

### 対応方針
- 範囲チェックによる安全な配列アクセス
- デフォルトフィールドへのフォールバック

## テスト設計

### 単体テスト
- 各キーバインドの動作確認
- フィールド境界でのナビゲーションテスト
- 既存機能との非干渉確認

### 統合テスト
- 実際のTUIでの操作テスト
- キーコンビネーションテスト

## パフォーマンス考慮

### 処理時間
- キーイベント処理: < 1ms
- UI再描画: < 50ms

### メモリ使用量
- 追加メモリ使用量: 最小限
- 既存構造の再利用

## 互換性設計

### 後方互換性
- 既存のtab/shift+tabキーバインド完全保持
- 既存ユーザーへの影響ゼロ

### 前方互換性
- 将来的なキーバインド追加への対応
- 設定システムとの統合準備